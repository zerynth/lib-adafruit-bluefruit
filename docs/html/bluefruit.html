

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Bluefruit &mdash; Bluefrit SPI Driver 1.0.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/zerynth.css" type="text/css" />
  

  

  
    <link rel="top" title="Bluefrit SPI Driver 1.0.0 documentation" href="index.html"/>
        <link rel="prev" title="Bluefruit" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> Bluefrit SPI Driver</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">Bluefruit</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#blestream-class">BLEStream class</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Bluefrit SPI Driver</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Bluefruit</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/bluefruit.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <span class="target" id="module-bluefruit"></span><div class="section" id="bluefruit">
<h1>Bluefruit<a class="headerlink" href="#bluefruit" title="Permalink to this headline">¶</a></h1>
<p>This module implements the driver for the Adafruit Bluefruit LE SPI family of products, based
on Bluefruit firmware v0.6.7 or greater (<a class="reference external" href="https://www.adafruit.com/products/2746">link</a>).</p>
<p>Data between the mcu and the Bluefruit hardware is exchanged by SPI or serial communication. However, this module has support
for SPI only.</p>
<dl class="function">
<dt id="bluefruit.init">
<code class="descname">init</code><span class="sig-paren">(</span><em>spidrv</em>, <em>nss</em>, <em>irqpin</em><span class="sig-paren">)</span><a class="headerlink" href="#bluefruit.init" title="Permalink to this definition">¶</a></dt>
<dd><p>Manually initialize the Bluefruit peripheral by activating the following communication setup:</p>
<blockquote>
<div><ul class="simple">
<li><em>spidrv</em> is the SPI peripheral to use (usually SPI0 for boards with an Arduino compatible layout)</li>
<li><em>nss</em> is the chip select pin (usually D8)</li>
<li><em>irqpin</em> is the pin used by the Bluefruit hardware to signal incoming messages (usually D7)</li>
</ul>
</div></blockquote>
<p>The SPI driver is started and the Bluefruit initialization sequence is sent.</p>
</dd></dl>

<dl class="function">
<dt id="bluefruit.hard_reset">
<code class="descname">hard_reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#bluefruit.hard_reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform a factory reset. Return True on success.</p>
</dd></dl>

<dl class="function">
<dt id="bluefruit.reset">
<code class="descname">reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#bluefruit.reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform a software reset. Return True on success.</p>
</dd></dl>

<dl class="function">
<dt id="bluefruit.gap_name">
<code class="descname">gap_name</code><span class="sig-paren">(</span><em>name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#bluefruit.gap_name" title="Permalink to this definition">¶</a></dt>
<dd><p>If <em>name</em> is None, return the current Bluefruit device name. Otherwise change the current name to <em>name</em>.0
Return True on success.</p>
</dd></dl>

<dl class="function">
<dt id="bluefruit.gap_adv">
<code class="descname">gap_adv</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#bluefruit.gap_adv" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup advertising data. Please refer to <a class="reference external" href="https://www.bluetooth.org/DocMan/handlers/DownloadDoc.ashx?doc_id=302735&amp;_ga=1.4683440.245686596.1452259520">this resource</a> for
a list of possible values accepted by the BLE standard.</p>
<p><em>data</em> is an iterable containing blocks of data in the following format:</p>
<blockquote>
<div><ul class="simple">
<li>byte 1: length of the block (n)</li>
<li>byte 2: type of the block</li>
<li>byte 3 to n: value of the block</li>
</ul>
</div></blockquote>
<p>Usually <em>data</em> is made of a flag block, followed by blocks advertising BLE services.</p>
<p>For example the sequence [0x02, 0x01, 0x06, 0x05, 0x02, 0x0d, 0x18, 0x0a, 0x18] is an encoding of the following info:</p>
<blockquote>
<div><ul class="simple">
<li>0x02: length of block 1</li>
<li>0x01: type of the block (&#8220;Flag&#8221;)</li>
<li>0x06: value of the block</li>
<li>0x05: length of block 2</li>
<li>0x02: type of block (&#8220;List of 16-bit Service UUID&#8221;)</li>
<li>0x180d, 0x180a: two 16 bit uuids. The first one is for a &#8220;Heart rate&#8221; service, the second for &#8220;Device Info&#8221; service.</li>
</ul>
</div></blockquote>
<p>Refer to <a class="reference external" href="https://www.bluetooth.org/en-us/specification/assigned-numbers/generic-access-profile">this</a> for a list of block types.</p>
<p>Return True on success.</p>
</dd></dl>

<dl class="function">
<dt id="bluefruit.gap_is_connected">
<code class="descname">gap_is_connected</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#bluefruit.gap_is_connected" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if Bluefruit hardware is connected to a client, 0 if not connected. Return None on failure.</p>
</dd></dl>

<dl class="function">
<dt id="bluefruit.gatt">
<code class="descname">gatt</code><span class="sig-paren">(</span><em>cfg=None</em><span class="sig-paren">)</span><a class="headerlink" href="#bluefruit.gatt" title="Permalink to this definition">¶</a></dt>
<dd><p>If <em>cfg</em> is None return the current <a class="reference external" href="https://learn.adafruit.com/introduction-to-bluetooth-low-energy/gatt">GATT</a> configuration.</p>
<p>Otherwise BLuefruit configuration is cleared first and then changed to <em>cfg</em>.</p>
<p>The format of <em>cfg</em> is a list of lists:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cfg</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mh">0x180D</span><span class="p">],</span>                     <span class="c"># Service with UUID 0x180D = Heart Rate</span>
      <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mh">0x2a37</span><span class="p">,(</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x40</span><span class="p">),</span><span class="mh">0x10</span><span class="p">],</span>  <span class="c"># Characteristic of last defined service</span>
      <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mh">0x2a38</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mh">0x02</span><span class="p">]</span>             <span class="c"># another characteristic</span>
<span class="p">]</span>
</pre></div>
</div>
<p>In the main list, a service is identified by a two elements list where the first element is an id (can be set to zero)
and the second element is the UUID of the service. If the UUID of the service is more than 32 bit, it can be passed as a tuple of bytes or as a bytearray.</p>
<p>Every list of 4 elements identifies a characteristic of the previously defined service. Characteristics are made of:</p>
<blockquote>
<div><ul class="simple">
<li>a handle at position 0: can be set to zero</li>
<li>a characteristic UUID: can be 16, 32 or 128 bits</li>
<li>a default value for the characteristic: can be a string, an integer or an iterable of bytes.</li>
<li>a permission flag: refer to <a class="reference external" href="https://learn.adafruit.com/introducing-the-adafruit-bluefruit-spi-breakout/ble-gatt">this</a> for reference</li>
</ul>
</div></blockquote>
<p>Return the configuration activated on the device or None on failure. After a configuration is successfully set, the return value
contains handles modified to the actual ones choosen by the device.</p>
</dd></dl>

<dl class="function">
<dt id="bluefruit.gatt_set">
<code class="descname">gatt_set</code><span class="sig-paren">(</span><em>handle</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#bluefruit.gatt_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the <em>value</em> of a characteristic given its <em>handle</em> (as returned after a successfull configuration). Value can be an integer, a string or an iterable of bytes.
Return False on failure.</p>
</dd></dl>

<dl class="function">
<dt id="bluefruit.gatt_get">
<code class="descname">gatt_get</code><span class="sig-paren">(</span><em>handle</em><span class="sig-paren">)</span><a class="headerlink" href="#bluefruit.gatt_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the value of the characteristic identified by <em>handle</em> (as returned after a successfull configuration).</p>
<p>Return None on failure.</p>
</dd></dl>

<dl class="function">
<dt id="bluefruit.addr">
<code class="descname">addr</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#bluefruit.addr" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the 48bit mac address of the device as an hex string. Return None on failure.</p>
</dd></dl>

<dl class="function">
<dt id="bluefruit.peer_addr">
<code class="descname">peer_addr</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#bluefruit.peer_addr" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the 48bit mac address of the client connected device as an hex string. Return None on failure.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">addr</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Return the RSSI level id dBm. Return None on failure.</p>
</dd></dl>

<dl class="function">
<dt id="bluefruit.tx_power">
<code class="descname">tx_power</code><span class="sig-paren">(</span><em>dbm=None</em><span class="sig-paren">)</span><a class="headerlink" href="#bluefruit.tx_power" title="Permalink to this definition">¶</a></dt>
<dd><p>If <em>dbm</em> is None, return the current transmission power level. Otherwise set the power level to <em>dbm</em> (in the range -40 to 4).</p>
<p>Return None on failure.</p>
</dd></dl>

<div class="section" id="blestream-class">
<h2>BLEStream class<a class="headerlink" href="#blestream-class" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="bluefruit.BLEStream">
<em class="property">class </em><code class="descname">BLEStream</code><span class="sig-paren">(</span><em>fifosize=1024</em><span class="sig-paren">)</span><a class="headerlink" href="#bluefruit.BLEStream" title="Permalink to this definition">¶</a></dt>
<dd><p>This class implements a serial stream on the Bluefruit peripheral. The internal implementation uses
a fifo buffer of <em>fifosize</em> bytes.</p>
<p>The BLEStream is not automatically set as the global serial stream.</p>
<p>Read and write methods are the same of any stream with the difference that they raise IOError if the BLEStream is
not connected (namely, the Bluefruit peripheral is not paired with a BLE client).</p>
<p>Also, due to the features of the Bluefruit firmware, read methods use a polling mechanism to check for incoming data.</p>
</dd></dl>

</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="index.html" class="btn btn-neutral" title="Bluefruit"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Zerynth Team.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
 var vurl
 if(location.href.indexOf("127.0.0.1")>=0) vurl=location.protocol+"//"+location.host+"/docs"
 else vurl="http://doc.zerynth.com"
 $(document).ready(function(){
                   $('.wy-breadcrumbs a:contains("Docs")').before('<a href="'+vurl+'">Zerynth</a> &#187;')
                   $('.wy-side-nav-search > a').removeClass("fa-home").removeClass("fa")
                   $('.wy-side-nav-search').prepend('<div class="viper-circle"><a href="'+vurl+'"><span style="color:#1c5e60" class="zerynth-Logo2"></span></a></div>')
 })
 </script>


</body>
</html>